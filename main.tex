\documentclass[11pt,twoside,openany]{book}

%%% PACKAGES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[french]{babel}
\usepackage{geometry}           % Configuration de la mise en page
\usepackage{microtype}          % Améliorations typographiques
\usepackage{fancyhdr}           % Personnalisation des en-têtes et pieds de page
\usepackage{ifluatex}           % Ce document compile-t-il avec LuaLaTeX ?
\usepackage{ifthen}             % Pour des effectuer des comparaisons
\usepackage[explicit]{titlesec} % Personnalisation des titres des  chapitres
\usepackage{titletoc}           % Personnalisation de la table des matières
\usepackage{verse}              % Améliore l'environnement verse de latex
\usepackage{perpage}            % Remet à 0 le compteur footnote sur chaque page
\usepackage{hyperref}           % Liens hypertextes & métadonnées

%%% CONFIGURATION %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifluatex
  \usepackage{fontspec}
  \defaultfontfeatures{Ligatures=TeX,Numbers=OldStyle}
  \setmainfont{ebgaramond}
\else
  \usepackage[utf8]{inputenc}
  \usepackage[T1]{fontenc}
  \usepackage[osf]{ebgaramond}
\fi

\geometry{
  papersize={9.33cm,15cm}, % In-18 carré
  textwidth=5.3cm,
  lines=20,
  headheight=13.6pt,
  headsep=3pt,
  marginparsep=7mm,
}

\frenchsetup{
  StandardLayout=true,
  AutoSpacePunctuation=false,
  og=«, fg=»,
}
\renewcommand{\frenchcontentsname}{Table}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    pdftitle={Considérations sur le jeu, les joueurs, la théorie des jeux, etc.},
    pdfauthor={Lablée, Jacques (1751-1841)},
    pdfproducer={Éric Guirbal},
}

%%% En-têtes
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[CE]{\scriptsize\textls[200]{\MakeUppercase{\leftmark}}}
\fancyhead[CO]{\scriptsize\textls[200]{\MakeUppercase{\rightmark}}}
\fancyhead[RO,LE]{\thepage}
\makeatletter
\renewcommand\chaptermark[1]{%
  \if@mainmatter
    \markboth{Considérations}{sur le jeu.}
  \else
    \markboth{#1.}{#1.}
  \fi
}
\fancypagestyle{plain}{%
  \if@mainmatter
    \ifnum\value{chapter}=1
      \fancyhf{}
    \fi
  \else
    \fancyhf{}
  \fi
}
\let\oldchapter\chapter
\renewcommand*{\chapter}{\@ifstar{\starchapter}{\@dblarg\nostarchapter}}
\newcommand*{\starchapter}[1]{\oldchapter*{#1}\chaptermark{#1}}
\def\nostarchapter[#1]#2{\oldchapter[{#1}]{#2}}
\makeatother

%%% Chapitres
\renewcommand{\thechapter}{%
  \ifnum\value{chapter}=1%
    premier%
  \else%
    \Roman{chapter}%
  \fi%
}

\makeatletter
% Ajoute un point au titre d'un chapitre s'il ne se termine pas déjà par
% un signe de ponctuation. Le code provient du package amsthm.sty
% et a été légèrement modifié.
\def\frenchspacing{
  \sfcode `\.\@m \sfcode `\?1500 \sfcode `\!\@m 
  \sfcode `\:\@m \sfcode `\;\@m  \sfcode `\,\@m
}
\DeclareRobustCommand{\addperiod}{%
  \relax\ifhmode
    \ifnum\spacefactor>\@m \else.\fi
  \fi%
}
\makeatother

\newcommand{\frontmatterchapterstyle}{%
  \titleformat{\chapter}[display]
    {\titlerule[3pt]\vspace{1.5pt}\titlerule[1pt]\vspace{4ex}\filcenter}
    {}
    {3ex}
    {\Large\textls*[100]{\MakeUppercase{##1}}.}
    [\vspace{1ex}\rule{1.2cm}{1pt}]
  \titlespacing{\chapter}{0pt}{-5ex}{5ex}
}

\newcommand{\mainmatterchapterstyle}{%
  \titleformat{\chapter}[display]
    {
      \normalfont\filcenter
      \ifnum\value{chapter}=1
        \titlerule[1pt]\vspace{1pt}\titlerule[1pt]\vspace{2.5ex}%
        {\Large CONSIDÉRATIONS} \\[1.7ex]
        {\scriptsize\textls[200]{SUR}} \\[1.7ex]
        {\large\textls[100]{LE JEU, LES JOUEURS,}} \\[3ex]
        {\small LA THÉORIE DES JEUX, etc.} \\[1.5ex]
        \rule{1.6cm}{1.6pt} \\[1.8ex]
      \else
        \titlerule[2pt]\vspace{1pt}\titlerule[1pt]\vspace{2.5ex}%
      \fi
    }
    {
      \textls*[150]{\MakeUppercase{\chaptertitlename\space\thechapter}}%
      \ifnum\value{chapter}=15%
        \scshape\hspace{0.3em} et\hspace{0.3em} dernier%
      \fi.
    }
    {1.5ex}
    {
      \ifnum\value{chapter}=2
        \scriptsize\textls*[200]{##1}\addperiod
      \else
        \itshape##1\addperiod
      \fi
    }
  \titlespacing{\chapter}
    {0pt}
    {\ifnum\value{chapter}=1 -4.5ex \else -5pt \fi}
    {*1}
}

\newcommand{\backmatterchapterstyle}{
  \titleformat{\chapter}[display]
    {\titlerule[1pt]\vspace{1.5pt}\titlerule[1pt]\vspace{2.5ex}}
    {}
    {}
    {\Large\filcenter\textls*[300]{\MakeUppercase{##1}}.}
    [\vspace{0pc}\rule{0.6cm}{0.8pt}]
  \titlespacing{\chapter}{0pt}{-5ex}{1ex}
}

%%% Notes de bas de page
\MakePerPage[1]{footnote}
\renewcommand{\footnoterule}{%
  \kern-2pt
  \hrule width \textwidth height 1pt
  \kern4pt
}
\renewcommand*{\thefootnote}{%
  (\kern0.5\fontdimen2\font\arabic{footnote}\kern0.5\fontdimen2\font)%
}
\makeatletter
\renewcommand*{\@makefnmark}{\unskip\nobreakspace\hbox{\normalfont\@thefnmark}}
\renewcommand{\@makefntext}[1]{%
  \parindent 0.8em%
  \indent
  \kern1.3em
  \llap{\@thefnmark}\hskip 2\fontdimen2\font #1%
}
\makeatother

%%% Table des matières
\contentsmargin{1.5em}
\titlecontents{chapter}
  [1em]
  {\hspace{-1em}}
  {%
    \scshape%
    \ifthenelse{\equal{\thecontentslabel}{premier}}{Chapitre}{Chap.}
    \thecontentslabel%
    \ifthenelse{\equal{\thecontentslabel}{XV}}{\normalfont{} et dernier}{}%
    . \normalfont\itshape
  }
  {\scshape}
  {\addperiod\titlerule*[0.6pc]{.}\contentspage}
  []

\makeatletter
\renewcommand{\tableofcontents}{%
  \if@twocolumn
    \@restonecoltrue\onecolumn
  \else
    \@restonecolfalse
  \fi
  \chapter*{\contentsname
      \@mkboth{%
         \MakeUppercase\contentsname}{\MakeUppercase\contentsname}}%
  \hfill{\scriptsize Pag}%
  \vskip-0.1ex%
  \@starttoc{toc}%
  \if@restonecol\twocolumn\fi
}
\makeatother

%%% Formatage des paragraphes
\setlength{\parindent}{0.8em}
\sloppy

%%% MACROS POUR LA SAISIE DU TEXTE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Folio du document source dans la marge
\newcommand{\folio}[1]{%
  \marginpar[\raggedleft\scriptsize#1]{\scriptsize#1}%
  \ignorespaces%
}

% Lettrines
\newcommand*{\lettrine}[2]{\noindent{\Large#1}\textsc{#2}}

% Texte entre parenthèses
\newcommand*{\paren}[1]{(~#1~)}

% Pour éviter que Dussaulx soit en italique dans le titre du premier chapitre
\renewcommand*{\bsc}[1]{\normalfont\scshape\textls*[100]{#1}}

%%% DÉBUT DU DOCUMENT %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\frontmatter
\frontmatterchapterstyle

\include{chapitres/00}

\mainmatter
\mainmatterchapterstyle

\include{chapitres/01}
\include{chapitres/02}
\include{chapitres/03}
\include{chapitres/04}
\include{chapitres/05}
\include{chapitres/06}
\include{chapitres/07}
\include{chapitres/08}
\include{chapitres/09}
\include{chapitres/10}
\include{chapitres/11}
\include{chapitres/12}
\include{chapitres/13}
\include{chapitres/14}
\include{chapitres/15}

\backmatter
\backmatterchapterstyle

\tableofcontents

\end{document}
